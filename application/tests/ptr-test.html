<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>IXmaps PTR Tests</title>
    <link rel="shortcut icon" href="/favicon.png">

    <script src="https://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
    <script src="../config.js"></script>
    <script src="./ptr-samples.js"></script>

    <script type="text/javascript">
      var tests = ['Success (201)', 'Malformed Json (400)', 'PTR Missing Key (401)', 'PTR Missing Value (402)'];
      // TODO
      // , 'Boomerang', 'Completed' others?

      var runTests = function() {
        jQuery("#response-container").text("");

        jQuery.each(tests, function(v, k) {
          var submission = ptrSubmissions[0];     // pulled from ptr-samples.js
          var obj = null;
          switch (v) {
            // TEST 1: 201 - no changes to json
            case 0:
              obj = JSON.stringify(submission);
              break;

            // TEST 2: 400 - malformed json
            case 1:
              obj = '{"a":"b","c":"d,}';
              break;

            // TEST 3: - misname a key in the json
            case 2:
              modifiedSubmission = JSON.parse(JSON.stringify(submission).split('"request_id":').join('"misnamed_key":'));
              obj = JSON.stringify(modifiedSubmission);
              break;

            // TEST 3 - remove a value from the json
            case 3:
              submission.request_id = "";
              obj = JSON.stringify(submission);
              break;
          }

          jQuery.ajax(config.ptr_url, {
            type: 'POST',
            data: obj,
            contentType: 'application/json',
            dataType: 'json',
            success: function(e) {
              jQuery("#response-container").append('<div style="color: #3e9600;">' + k + ' test PASSED </div><br />');
            },
            error: function(e) {
              if (e.status == 400 || e.status == 401 || e.status == 402) {
                jQuery("#response-container").append('<div style="color: #3e9600;">' + k + ' test PASSED with expected error returned >> ' + e.statusText+ '</div><br />');
              } else {
                jQuery("#response-container").append('<div  style="color: #f21713;">' + k + ' test FAILED with unexpected error returned >> ' + e.statusText+ '</div><br />');
              }
            }
          });
        });
      }

      jQuery(document).ready(function() {
        jQuery('#submit').click(function() {
          runTests();
        });
      });
    </script>
  </head>

  <body>
    <h2>Test suite for the CIRA PTR API</h2>
    <button id="submit">Begin test</button>
    <br />
    <br />
    <br />
    <div id="response-container" style="margin-left: 30px;"></div>
  </body>
</html>